package test

import (
	"testing"
	"DNA/vm/avm"
	"DNA/vm/avm/interfaces"
	"fmt"
	"DNA/core/ledger"
	"DNA/core/store/ChainStore"
	"DNA/core/transaction"
	"DNA/crypto"
	"DNA/smartcontract/service"
	"DNA/common"
	"encoding/hex"
)

func TestAVM(t *testing.T) {
	fmt.Println("//**************************************************************************")
	code := `53C56B6C766B00527AC46C766B51527AC46C766B00C3766C766B52527AC464C6006C766B52C305717565727987633A006C766B52C3087265676973746572876337006C766B52C3087472616E73666572876344006C766B52C30664656C65746587636C006280006C766B51C300C361657A00616C75666C766B51C300C36C766B51C351C36C766B51C352C361527265A600616C75666C766B51C300C36C766B51C351C36C766B51C352C36C766B51C352C3615379517955727551727552795279547275527275653401616C75666C766B51C300C36C766B51C351C3617C65FF01616C756600616C756651C56B6C766B00527AC461681C416E745368617265732E53746F726167652E476574436F6E746578746C766B00C3617C6815416E745368617265732E53746F726167652E476574616C756654C56B6C766B00527AC46C766B51527AC46C766B52527AC46C766B51C36C766B52C3617CAC63080000616C756661681C416E745368617265732E53746F726167652E476574436F6E746578746C766B00C3617C6815416E745368617265732E53746F726167652E4765746C766B53527AC46C766B53C364080000616C756661681C416E745368617265732E53746F726167652E476574436F6E746578746C766B00C36C766B51C36152726815416E745368617265732E53746F726167652E50757451616C756655C56B6C766B00527AC46C766B51527AC46C766B52527AC46C766B53527AC46C766B52C36C766B53C3617CAC63080000616C756661681C416E745368617265732E53746F726167652E476574436F6E746578746C766B00C3617C6815416E745368617265732E53746F726167652E4765746C766B54527AC46C766B54C363080000616C75666C766B54C36C766B51C3617CAC63080000616C756661681C416E745368617265732E53746F726167652E476574436F6E746578746C766B00C36C766B52C36152726815416E745368617265732E53746F726167652E50757451616C756653C56B6C766B00527AC46C766B51527AC461681C416E745368617265732E53746F726167652E476574436F6E746578746C766B00C3617C6815416E745368617265732E53746F726167652E4765746C766B52527AC46C766B52C363080000616C75666C766B52C36C766B51C3617CAC63080000616C756661681C416E745368617265732E53746F726167652E476574436F6E746578746C766B00C3617C6818416E745368617265732E53746F726167652E44656C65746551616C7566`
	ledger.DefaultLedger = new(ledger.Ledger)
	ledger.DefaultLedger.Store = ChainStore.NewLedgerStore()
	ledger.DefaultLedger.Store.InitLedgerStore(ledger.DefaultLedger)
	transaction.TxStore = ledger.DefaultLedger.Store
	crypto.SetAlg(crypto.P256R1)
	var cryptos interfaces.ICrypto
	cryptos = new(avm.ECDsaCrypto)
	service := service.NewStateMachine()
	avm := avm.NewExecutionEngine(nil, cryptos, nil, service, common.Fixed64(0))
	codes, _ := hex.DecodeString(code)
	ret, err := avm.Create(codes, nil)

	fmt.Println("ret:", ret, "err:", err)
}
